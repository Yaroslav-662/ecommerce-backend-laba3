Ecommerce Backend — Лабораторна робота №3

Тема: Інтеграція WebSocket (Socket.io) та розширений функціонал
Автор: Поліщук Ярослав, група ІПЗ-42
GitHub: https://github.com/Yaroslav-662/ecommerce-backend-laba3

Рівень складності: 3

Встановлення та запуск локально

Клонування репозиторію:

git clone https://github.com/Yaroslav-662/ecommerce-backend-laba3.git
cd ecommerce-backend-laba3


Встановлення залежностей:

npm install


Створення .env файлу (приклад):

PORT=5000
MONGO_URI=<твоє MongoDB підключення>
JWT_SECRET=<секретний ключ JWT>
FRONTEND_URL=http://localhost:3000


Запуск у режимі розробки:

npm run dev


Запуск production:

npm run start


Запуск тестового WebSocket клієнта:

Відкрий файл ws-tester.html у браузері.

Введи URL бекенду: https://localhost:5000 або URL деплойного сервера.

Введи JWT токен користувача для підключення.

Використовуй кнопки Connect, Join room, Leave, Send для перевірки подій.

Деплой на Render

Створи новий Web Service на Render.

Вкажи GitHub репозиторій: Yaroslav-662/ecommerce-backend-laba-3.

Вибери branch: main або master.

Встанови середовище:

Build Command: npm install

Start Command: npm run start

Environment Variables: додай всі змінні з .env

Натисни Deploy.

Після успішного деплою ти отримаєш URL для WebSocket підключення та REST API.

WebSocket Events (Socket.io)

Підключення:

URL: https://<backend-url>/socket.io

Auth: JWT токен користувача

Основні події:

Подія	Опис	Вхідні дані	Вихідні дані
order:create	Створення замовлення	{ items: [{product, quantity, price}], total }	order:created
order:updateStatus	Оновлення статусу замовлення	{ orderId, status }	order:updated
joinRoom	Підключення до кімнати	room	ack {ok:true, room}
leaveRoom	Вихід з кімнати	room	ack {ok:true, room}
message	Надсилання повідомлення в кімнату	{ room, text }	ack {ok:true}
presence:update	Оновлення онлайн-статусу	{ userId, status }	broadcast всім
whoami	Отримати інформацію про підключеного користувача	—	{ userId, role }

Примітки:

Події підтримують ack callback для підтвердження доставки.

При розриві з’єднання WebSocket виконує автоматичне повторне підключення (reconnection).

Тестування

Всі події WebSocket перевірені через ws-tester.html.

Створення та оновлення замовлень, онлайн-статуси, персональні повідомлення та reconnection працюють коректно.







Звіт з лабораторної роботи №3

Тема роботи: Інтеграція WebSocket (Socket.io) та розширений функціонал

Здобувач освіти: Поліщук Ярослав
Група: ІПЗ-42
GitHub репозиторій: https://github.com/Yaroslav-662/ecommerce-backend-laba3
Render:https://ecommerce-backend-mgfu.onrender.com
Рівень складності: 3

Реалізований функціонал
Рівень 1

Інтегровано Socket.io до існуючого Express.js застосунку.

Реалізовано базове WebSocket підключення між сервером та клієнтом.

Створено систему кімнат (rooms) для групування користувачів.

Впроваджено real-time оновлення для основної сутності (замовлення).

Реалізовано базову систему сповіщень користувачів.

Проведена оптимізація найповільніших запитів до бази даних (MongoDB).

Задеплоєно бекенд на безкоштовний хостинг (Render).

Тестування:

Створення замовлення через WebSocket (order:create) — успішно, отримано order:created.

Підключення до кімнати (joinRoom) — успішно, отримано підтвердження joined.

Надсилання повідомлення в кімнату (message) — успішно, отримано ack.

Рівень 2

Реалізовано автентифікацію WebSocket з'єднань через JWT токени.

Створено систему персоналізованих сповіщень з різними типами та пріоритетами.

Впроваджено real-time оновлення для всіх основних сутностей (замовлення, статуси, користувачі).

Додано індикатори онлайн-статусу користувачів (presence:update).

Реалізовано механізм reconnection при втраті з’єднання.

Проведено комплексну оптимізацію запитів через індексування та кешування.

Тестування:

Оновлення статусу замовлення (order:updateStatus) — успішно, отримано order:updated зі статусом "paid".

Персональні повідомлення та сповіщення (notification:send, typing) — успішно, ack підтверджує доставку.

Повторне підключення після розриву (disconnect → connect) — з’єднання відновлюється, користувачі відображаються онлайн.

Рівень 3 (архітектура)

Реалізовано архітектурні рішення для горизонтального масштабування WebSocket (через Redis adapter).

Додано систему rate limiting для WebSocket подій.

Реалізовано систему черг для обробки фонових задач (черга обробки замовлень).

Розроблено advanced кешування з використанням Redis.

Додано систему metrics та моніторингу застосунку.

Підготовлено документацію WebSocket API для масштабування та інтеграцій.

Примітка:
Рівень 3 архітектури розроблений і готовий до адаптації, проте Render наразі не підтримує горизонтальне масштабування з Redis adapter. Реалізація на майбутнє можлива на хостингах з підтримкою Redis та кластеризації WebSocket.

Ключові фрагменти коду

Створення замовлення через Socket.io:

socket.emit("order:create", {
  items: [
    { product: "64a1b2c3d4e5f67890123456", quantity: 2, price: 100 },
    { product: "64a1b2c3d4e5f67890123457", quantity: 1, price: 150 }
  ],
  total: 350
});


Оновлення статусу замовлення:

socket.emit("order:updateStatus", {
  orderId: "69375ef26e35b57c6c428e7b",
  status: "paid"
});


Прийом подій у реальному часі:

socket.on("order:updated", (order) => {
  console.log("Order updated:", order);
});

socket.on("presence:update", (data) => {
  console.log("User presence:", data);
});

Тестування WebSocket (Socket.io)

Тестування всіх подій та сценаріїв проводилося за допомогою файлу ws-tester.html (Socket.io Tester — Verbose), який дозволяє:

Підключатися до бекенду через WebSocket з JWT токеном.

Підключатися/виходити з кімнат (joinRoom, leaveRoom).

Надсилати події (emit) та отримувати ack-відповіді від сервера.

Переглядати всі incoming події та статуси (EVENT, presence:update, order:created, order:updated).

Приклади протестованих сценаріїв:

Сценарій	Подія	Вхідні дані	Результат
Створення замовлення	order:create	список продуктів з кількістю та ціною, total	отримано order:created з підтвердженням від сервера
Оновлення статусу замовлення	order:updateStatus	orderId та status: paid	отримано order:updated зі статусом "paid"
Персональні сповіщення та індикатори онлайн-статусу	presence:update, message	повідомлення у кімнаті	користувачі відображаються онлайн, повідомлення доставляються у реальному часі
Reconnection при втраті з’єднання	disconnect → connect	—	WebSocket автоматично відновлюється, онлайн-статус зберігається
Висновки

Повністю реалізовано інтеграцію WebSocket у Express.js застосунок.

Реалізовано усі функції для рівнів 1–2 та підготовлено рівень 3 архітектури для майбутнього масштабування.

Система підтримує реальне оновлення замовлень, сповіщення користувачів, індикатори онлайн-статусу та безпечну автентифікацію через JWT.

Код протестований через Socket.io Tester, всі події та ack-відповіді працюють коректно.

Архітектура рівня 3 готова для масштабування (Redis adapter, rate limiting, черги), хоча Render наразі не підтримує горизонтальне масштабування WebSocket.

Самооцінка: 5 / 5

Обґрунтування:

Реалізовано всі вимоги рівнів 1–2: інтеграція WebSocket, автентифікація через JWT, реальне оновлення замовлень, персональні сповіщення, онлайн-статуси, механізм reconnection, оптимізація запитів.

Рівень 3 реалізовано архітектурно: підготовлено горизонтальне масштабування WebSocket, rate limiting, черги, advanced кешування, моніторинг — готово для майбутньої адаптації на хостингах з підтримкою Redis.

Код повністю робочий і протестований за допомогою ws-tester.html.

Структура WebSocket API відповідає сучасним вимогам для real-time застосунків.

